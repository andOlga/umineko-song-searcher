const ytMap = {
  1: 'jEUw0YgN-h4',
  2: '7sxfABkV3oU',
  3: 'vRaNer0BgwY',
  4: 'Ul2C_5MAg1E',
  5: '5S8jw_-hOHY',
  6: 'tQ_St-C3HdM',
  7: 'Y36TqR7jFsQ',
  8: 'QTAcJ0ZcUkI',
  9: 'PQK2QbMW-Qk',
  10: 'yXHatTQBT6A',
  11: 'uZd41NMBM4s',
  12: 'QmDxRYf1mMs',
  13: 'tPIxN7byEEw',
  14: '5AMIA-5Op4c',
  15: 'O4dv8CAFStw',
  16: 'hT167XU_7_s',
  17: '-wJwfgttZ60',
  18: 'deyR5Zdapzs',
  19: 'ENL0nPskSao',
  20: 'X76lu7TCvOg',
  21: 'Fj4grmCRRRw',
  22: 'o5t6l_2mM2Q',
  23: 'rBdrlg2zVH4',
  24: 'raxEmANPTVc',
  25: 'oBfV7ydrj-k',
  26: 'kRf7NlyiGfk',
  27: '5-5pAmoR5AA',
  28: 'HcE1_uKySnQ',
  29: 'WYHy3VnZRp0',
  30: '9m4LbXNcjmU',
  31: 'IDma4A6A3Bc',
  32: 'Hm6BKgnuW_s',
  33: 'w_o6Tpk8M1E',
  34: 'Pi_8gujWJMc',
  35: 'N62StawMcC8',
  36: 'M4VR-SGWIsI',
  37: 'Zs4wKRHmiR8',
  38: 'Xkun-83JvF8',
  39: 'kVP09lhSPm4',
  40: '3ofk8ff5mbU',
  41: 'YGLSZ2Lm588',
  42: 'cZYGGfhxeRY',
  43: 'JHpgQFdnBtM',
  44: 'R0yYXgnSwmE',
  45: 'UX3L-gs4MPs',
  46: 'Ps6R4nN4CVw',
  47: 'szNUd-oj2dE',
  48: 'szNUd-oj2dE',
  49: 'UpwgLtnWJgc',
  50: '32FzpPjwh6g',
  51: 'WL5BYyHdFKc',
  52: 'mxMQn6wJ5qQ',
  53: '7L_T0CCdx0s',
  54: 'mVr0IUQ6BwE',
  55: 'e3ZvuaqK66g',
  56: 'QibQrCHT2sc',
  57: 'XxEZna3ROgQ',
  58: 'iLxXeeOSB8w',
  59: '6QEYmbm3RZU',
  60: 'CIhkXQtSuD4',
  61: 'aonwECESgkE',
  62: 'Gh1VTKXCGVQ',
  63: 'zc2mvEE5hQA',
  64: 'Rd5Vt_qct0s',
  65: 'KZ9D05ll2Rw',
  66: 'qunBNGMNt3k',
  67: 'DGI1XWx1szM',
  68: '4-DsfmZWxrk',
  69: 'MqrTHd49aJ0',
  70: 'K03LLn6LpBY',
  71: 'zVSOu2Tjshg',
  72: 'EWPBKAqJgsw',
  73: 'v6aN04YAH4U',
  74: '1ksK1dudxDw',
  75: 'AV0OnZtHHz4',
  76: 'XCfsa8YhEIE',
  77: 'Nf4AKMhw2MU',
  78: '--vdeq-zTgA',
  79: 'xiHA7Aw2GiE',
  80: 'PwscHXEeGys',
  81: '7lfKRZPs7kQ',
  82: 'Q6YgNtJNr6A',
  83: 'MsKmKq58I1Q',
  84: 'Ej7Uty_0Vww',
  85: 'AFuzVeJnSR0',
  86: 'A4MokPYfeLk',
  87: 'FnKJGcmpkaI',
  88: 'Ap8uODRkXEs',
  89: 'V8Bda1WfDfk',
  90: 'PxxAmlmVvQ4',
  91: '6Ekl2p3Is7E',
  92: 'WZMbsNxYw3c',
  93: 'Jv7f2vPCSwI',
  95: 'FgwRpcVMUKE',
  96: '0GxfJ40eDas',
  97: 'wlZddhshK0U',
  98: 'l5vk9lMWOBE',
  99: '8UJRCwLKspA',
  100: 'qEMLNCTkzdM',
  101: '-HJKJxQRmgc',
  102: 'SPJXp3xPglY',
  103: '4jADErEGJLQ',
  104: 'utPpd8q-xpM',
  105: 'eBo7QL__wZQ',
  106: 'xSKWf_20Lkg',
  107: '6Qs9EiK_JJE',
  108: 'zDPJuAxZaOo',
  109: 'etRKYxtFA-U',
  110: 'TeW13C_4NXw',
  111: 'ZZ3NrtGdtUs',
  112: 'kcTxd5qQChw',
  113: 'kE7Qvi2V-8o',
  114: 'kZB7aTrX2bE',
  115: 'fZi1g9m2in4',
  116: 'ZZWeg_C-Bzw',
  117: 'daeEZHSYGHM',
  118: '7cwaWybHkuE',
  119: 'hxliVmx39OI',
  120: 'UWgEwE1gArE',
  121: 'ggn8riHTDqw',
  122: 'idJLgN2Pu0I',
  123: 'EFegbnVwCpo',
  124: 'zMVh99cpPuk',
  125: '9uy6rfyZwnU',
  126: 'dORf0tLaSn8',
  127: 'x_2Sso-JoO4',
  128: 'MNl4PNFubvQ',
  129: 'YSb6-3W9370',
  130: 'G7GLvyHjuZY',
  131: '3aDk-Kxen9E',
  132: 'u6yxzjpZ5wU',
  133: 'CSLL6pzOLXQ',
  134: 'CbJTxrMH5Yc',
  135: 'mPkKuKc4-2I',
  136: 'GkEtpx8bcJ8',
  137: 'eJ1CeuQMv7s',
  138: 'T3KPybMNKSk',
  139: 'SEw0PPcNdHY',
  140: 'kbhPq4pGn8M',
  141: '9FAsbUm0hIQ',
  142: 'eSQO0I5FHoc',
  143: '1A44lG8CJfA',
  144: 'tOFgnKn_T2g',
  145: 'y_ylNrVEvzY',
  146: 'pAkvF7HkFEY',
  147: '7O18lICr-5Q',
  148: 'bCkOCmciLcU',
  149: 'jfIsbeR6nWw',
  150: 'vJdaEeW5xVY',
  151: 'QSAcfUz17EQ',
  152: 'ihkjgy9FbPY',
  153: 'GICj8tVx0lQ',
  154: 'p7ByDX00sGI',
  155: 'sGgnNl9zbuc',
  156: 'Ptx1SP77Dcc',
  157: 'bM-Stt5Yq6o',
  158: 'lg5Fw0B3tCU',
  159: 'dG3MJpnt1gA',
  160: '-JBKyLZd6GA',
  161: 'X1dmB2z39_8',
  162: 'JLSAv8vhgsQ',
  163: 'tKUSi2apj1k',
  164: 'p6xbvsPVv1E',
  165: 'SYl1hLAPoRc',
  166: 'QSJVvftCR64',
  167: 'Wt4GGsj39H8',
  168: 'DX32Qeq9z1s',
  169: 'mAy_wBQ13ZE',
  170: 'JZrLFLgabGU',
  171: 'Ba7CwkGPQCM',
  172: 'oa_u_DI0fvg',
  173: 'T9T17pdMhrY',
  174: 'T2W-G-LmBA0',
  175: 'CJCObVmVr7g',
  176: 'WbZbMSp7x18',
  177: 'xoCg4BiVAMI',
  179: 'Sas87qoYcfE',
  180: 'IO9AKnb1vww',
  181: 'tmGtaw8gMpA',
  183: 'Qi3eAjB_LcA',
  184: '4AHOh9tTNfo',
  185: 'hg9XPcPKYAQ',
  186: 'sOO7t-UaTic',
  187: 'L8uddlTg7AE',
  188: 'srAkT72YhCc',
  190: 'otBqRCQxIwo',
  191: 'ei6cC93h84I',
  192: '1dgLGcxY1-s',
  193: 'MHomiMPH4mc',
  194: 'mkMDmaghbkA',
  195: 'o_gqY7QVXd4',
  240: 'p33Yikb5UmI',
  241: 'PDkOre9ZUyg',
  1000: 'MZUfXX00RaY',
  1010: 'EWDpCAt2LGI',
  1013: 'EWDpCAt2LGI'
}

const nameMap = {
  1: 'Thunberg Lily',
  2: 'Door of Summer',
  3: 'HANE (Feathers)',
  4: 'Ride on',
  5: 'sea',
  6: 'Hour of Darkness',
  7: 'Novelette',
  8: 'hope',
  9: 'White Shadow',
  10: 'steady pace',
  11: 'Towering cloud in summer',
  12: 'Moonlit Night',
  13: 'Rose',
  14: 'At Death’s Door',
  15: 'Hell’s Halls',
  16: 'Fortitude',
  17: 'witch in gold(cembalo)',
  18: 'Beckoning',
  19: 'Fishy Aroma',
  20: 'stupefaction',
  21: 'praise',
  22: 'Pass',
  23: 'butterfly',
  24: 'goldenslaughterer',
  25: 'Worldend(bp)',
  26: 'The Witch of the Painting',
  27: 'suspicion',
  28: 'Scar in the Score',
  29: 'Core',
  30: 'Minute darkness',
  31: 'nighteyes',
  32: 'Closed My Heart',
  33: 'Requiem',
  34: 'mind',
  35: 'Worldend',
  36: 'play',
  37: 'system0',
  38: 'Voiceless',
  39: 'dead angle',
  40: 'Organ Short #600 Million in C Minor',
  41: 'Prison STRIP',
  42: 'String Quartet #1 in G Major — I.Allegro',
  43: 'cage',
  44: 'Golden Sneer',
  45: 'Scorpion Guts',
  46: "Life's End (VerC)",
  47: 'Answer',
  48: 'Answer short',
  49: 'Melody inst.ver',
  50: 'Red Dread',
  51: 'moon',
  52: 'where',
  53: 'Dread of the grave',
  54: 'Worldend dominator',
  55: 'Black Liliana',
  56: 'Rest',
  57: 'End of a Daydream',
  58: 'Melody',
  59: 'Over the sky',
  60: 'sunny spot',
  61: 'The Candles Dance',
  62: 'Distant',
  63: 'psy-chorus',
  64: 'far',
  65: 'red shoes FAKE',
  66: 'mother',
  67: 'haze',
  68: 'Dancing Pipe',
  69: 'Dread of the grave -More fear-',
  70: 'Organ Short #200 Million in C Minor',
  71: 'rhythm-changer',
  72: 'happiness of marionette bonus',
  73: 'happiness of marionette',
  74: 'Dance of the Moon Rabbits',
  75: 'Melting away',
  76: 'soul of soul',
  77: 'miragecoordinator',
  78: 'prison',
  79: 'Thanks for being born',
  80: 'Wings',
  81: 'Paradise Lost',
  82: 'wingless',
  83: 'activepain',
  84: 'Dread of the grave -rhythm ver-',
  85: 'Eternity',
  86: 'over',
  87: 'Like the gale',
  88: 'F Style',
  89: 'Monochrome Clock',
  90: 'apathy',
  91: 'Mystic Forest',
  92: "Sakutarou's Adventure",
  93: 'Parallel',
  95: '599 million ruins',
  96: 'Happy Maria!(Instrumental)',
  97: 'Surrounding',
  98: 'open fire',
  99: 'death(from stupefaction)',
  100: 'mortal stampede',
  101: 'Victima propiciatoria',
  102: 'Revolt',
  103: 'Purgatory Catastrophe Rhapsodie',
  104: 'Happy Maria!',
  105: 'dive to emergency',
  106: 'dir',
  107: 'Endless Nine',
  108: 'dreamenddischarger',
  109: 'Discode',
  110: 'twirl',
  111: 'Future',
  112: 'Deep Blue Jeer',
  113: 'The Great Detective Knows',
  114: 'Smileless Soirée',
  115: 'one',
  116: 'Spiral',
  117: 'String Trio #600 Million in F-Sharp Minor',
  118: 'Totenblume',
  119: 'JUSTICE',
  120: 'ACI-L',
  121: 'Predator',
  122: 'Proud-dust',
  123: 'hello your dream',
  124: 'A Lonely Deep-Sea Fish',
  125: 'The Girls’ Witch Hunt',
  126: 'Patchwork Chimera',
  127: 'discolor',
  128: 'resurrectedreplayer',
  129: 'Final Answer',
  130: 'light',
  131: 'Bread of Life',
  132: 'Promise',
  133: 'Tomorrow',
  134: 'WINGS(Ver hope)',
  135: 'Fake Gray Smile',
  136: 'Eternal Chains',
  137: 'Love Examination',
  138: 'Instant',
  139: 'Look Back',
  140: 'Blue Butterfly',
  141: 'my dear',
  142: 'Something’s Up & Going Down',
  143: 'rog-limitation',
  144: 'Waltz Op.34',
  145: 'ALIVE',
  146: 'birth of new witch(inst)',
  147: 'ruriair',
  148: 'Engage of marionette',
  149: 'Life',
  150: 'Loreley',
  151: 'The Sin',
  152: 'The first and The last',
  153: 'Anti-Demon Sequentia',
  154: 'battle field',
  155: 'Rebirth',
  156: 'The Way',
  157: 'liberatedliberator',
  158: 'Thanks for all people',
  159: 'Infant Queen Bee',
  160: 'birth of new witch(Short Ver)',
  161: 'FISHYAROMA',
  162: 'le4-octobre',
  163: 'l&d-circulation',
  164: 'reflection-call',
  165: 'rain',
  166: '7-weights',
  167: 'fall',
  168: 'bore-ral',
  169: 'ballade-continuer',
  170: 'Song without a name ver.2007 inst',
  171: 'lie-alaia',
  172: 'Golden Nocturne(inst)',
  173: 'far(flat)',
  174: 'Toybox',
  175: 'terminal entrance',
  176: 'Puppet Show',
  177: 's/he-end',
  179: 'Song without a name full-inst',
  180: 'The End Of The World',
  181: 'goddess-gardena',
  183: 'ridicule',
  184: 'Yomotsu Hirasaka Corruption',
  185: 'the executioner',
  186: 'Song without a name ver.sakura ED-size',
  187: 'Stuffed Animal',
  188: 'Bizarre Divertimento',
  190: 'en-counse',
  191: 'lixAxil',
  192: 'Revelations(inst)',
  193: 'Flying',
  194: 'lastendconductor',
  195: 'Revelations',
  240: 'Cocoon of White Dreams -Ricordando il passato-',
  241: 'When the Seagulls Cry',
  1000: 'SuiSui☆SWEETS(^-^)',
  1010: 'Bring The Fate',
  1013: 'Bring The Fate(Ver chiru)'
}

async function search (query) {
  if (!query) return null
  query = query.toLowerCase()
  const resp = await fetch('script.u')
  if (!resp.ok) return null
  const contents = await resp.text()
  const matches = contents.toLowerCase().split(/bgm1v?|bgmplay2?/m)
  for (const match of matches) {
    if (match.includes(query)) {
      const thing = match.split(/\n|,/m)[0].trim()
      const title = nameMap[thing]
      const yt = ytMap[thing]
      const filename = contents.match(new RegExp(`BGM_s_Ch = ${thing}\\s+mov.+"(.+)"`))[1].replace(/\\/g, '/')
      if (title && filename && yt) {
        return { title, filename, yt }
      } else {
        return null
      }
    }
  }
}

async function addResult (q) {
  document.getElementById('result').style.display = 'block'
  const rt = document.getElementById('resultText')
  const yt = document.getElementById('yt')
  const data = await search(q)
  if (data) {
    rt.innerText = `Search result: ${data.title} (${data.filename})`
    yt.src = `https://www.youtube-nocookie.com/embed/${data.yt}`
  } else {
    rt.innerText = 'Nothing found.'
    yt.src = 'https://www.youtube-nocookie.com/embed/bnH9Gbw4ybk'
  }
}

document.addEventListener('DOMContentLoaded', event => {
  const q = new URLSearchParams(document.location.search).get('q')
  if (q) {
    addResult(q)
  }
})
